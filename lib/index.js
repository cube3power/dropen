(function(global,factory){if(typeof define==='function'&&define.amd){define(['exports','events','./utils','./helpers'],factory)}else if(typeof exports!=='undefined'){factory(exports,require('events'),require('./utils'),require('./helpers'))}else{var mod={exports:{}};factory(mod.exports,global.events,global.utils,global.helpers);global.index=mod.exports}})(this,function(exports,_events,_utils,_helpers){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Dropen=function(_EventEmitter){_inherits(Dropen,_EventEmitter);function Dropen(el,_ref){var preview=_ref.preview,dragoverClass=_ref.dragoverClass,_ref$autoPreview=_ref.autoPreview,autoPreview=_ref$autoPreview===undefined?true:_ref$autoPreview,_ref$autoRefresh=_ref.autoRefresh,autoRefresh=_ref$autoRefresh===undefined?true:_ref$autoRefresh,imageMinWidth=_ref.imageMinWidth,imageMinHeight=_ref.imageMinHeight,imageMaxWidth=_ref.imageMaxWidth,imageMaxHeight=_ref.imageMaxHeight;_classCallCheck(this,Dropen);var _this2=_possibleConstructorReturn(this,(Dropen.__proto__||Object.getPrototypeOf(Dropen)).call(this));var _el=(0,_helpers.makeElement)(el);_this2._isFileElement=false;if(_el instanceof HTMLInputElement){if(_el.type!=='file'){throw TypeError('"el" is HTMLElement but not input[type="file"].')}_this2._isFileElement=true}_this2._el=_el;_this2._files=[];_this2._preview=(0,_helpers.makeElement)(preview);_this2._autoPreview=autoPreview;_this2._autoRefresh=autoRefresh;_this2._dragoverClass=dragoverClass;_this2._imageMinWidth=imageMinWidth;_this2._imageMinHeight=imageMinHeight;_this2._imageMaxWidth=imageMaxWidth;_this2._imageMaxHeight=imageMaxHeight;_this2._attachEvent();return _this2}/**
   * Attach event to "el" (HTMLElement)
   */_createClass(Dropen,[{key:'_attachEvent',value:function _attachEvent(){var _this=this,el=_this._el;if(this._isFileElement){el.addEventListener('change',this.onChange.bind(this))}else{el.addEventListener('dragover',this.onDragover.bind(this));el.addEventListener('dragleave',this.onDragleave.bind(this));el.addEventListener('drop',this.onDrop.bind(this))}}},{key:'onChange',value:function onChange(e){var _this=this,el=_this._el;_this.emit('upload',{currentFiles:_this.getFiles(),targetFiles:e.target.files});(0,_utils.removeClass)(el,_this._dragoverClass);if(_this._autoRefresh){_this.clearFiles();_this.applyToHTML()}_this.addFiles(e.target.files);if(_this._autoPreview){_this.applyToHTML()}_this.emit('uploadend',{currentFiles:_this.getFiles(),targetFiles:e.target.files})}},{key:'onDragover',value:function onDragover(e){var _this=this,el=_this._el;(0,_utils.stopEvent)(e);(0,_utils.addClass)(el,_this._dragoverClass)}},{key:'onDragleave',value:function onDragleave(e){var _this=this,el=_this._el;(0,_utils.stopEvent)(e);(0,_utils.removeClass)(el,_this._dragoverClass)}},{key:'onDrop',value:function onDrop(e){var _this=this,el=_this._el;(0,_utils.stopEvent)(e);_this.emit('upload',{currentFiles:_this.getFiles(),targetFiles:e.dataTransfer.files});(0,_utils.removeClass)(el,_this._dragoverClass);if(_this._autoRefresh){_this.clearFiles();_this.applyToHTML()}_this.addFiles(e.dataTransfer.files);if(_this._autoPreview){_this.applyToHTML()}_this.emit('uploadend',{currentFiles:_this.getFiles(),targetFiles:e.dataTransfer.files})}},{key:'getEl',value:function getEl(){return this._el}},{key:'getPreview',value:function getPreview(){return this._preview}},{key:'getFiles',value:function getFiles(){return this._files}},{key:'addFile',value:function addFile(file){if(file instanceof File||file instanceof Blob){this._files.push(file)}}},{key:'addFiles',value:function addFiles(files){var _this=this;if(files instanceof Array||files instanceof FileList){[].filter.call(files,function(f){return f instanceof File||f instanceof Blob}).forEach(function(f){return _this.addFile(f)})}if(files instanceof File||files instanceof Blob){_this.addFile(files)}}},{key:'clearFiles',value:function clearFiles(){this._files=[]}},{key:'applyToHTML',value:function applyToHTML(){if(this._preview){this.removeFromPreviewHTML();this.appendToPreviewHTML()}}},{key:'removeFromPreviewHTML',value:function removeFromPreviewHTML(){if(this._preview){this._preview.innerHTML=''}}},{key:'appendToPreviewHTML',value:function appendToPreviewHTML(){var _this=this;if(!_this._preview){throw Error('Not configure option: preview')}var fragment=document.createDocumentFragment();Array.prototype.forEach.call(_this._files,function(f){var obj=(0,_helpers.createPreviewElement)(f);obj.style['min-width']=_this._imageMinWidth;obj.style['min-height']=_this._imageMinHeight;obj.style['max-width']=_this._imageMaxWidth;obj.style['max-height']=_this._imageMaxHeight;fragment.appendChild(obj)});_this._preview.appendChild(fragment)}}]);return Dropen}(_events.EventEmitter);if(window){window.Dropen=Dropen}exports.default=Dropen});